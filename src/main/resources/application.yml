# Spring Boot Configuration for Zoom Transcriber
server:
  port: 8080
  servlet:
    context-path: /
    
spring:
  application:
    name: zoom-transcriber

  # Database configuration for development
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: ""

  # JPA/Hibernate configuration
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true

  # Jackson configuration
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
    deserialization:
      fail-on-unknown-properties: false

  # Web configuration
  webflux:
    base-path: /api
    
# Management and Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
      probes:
        enabled: true
    metrics:
      enabled: true
    prometheus:
      enabled: true
    loggers:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
        step: 60s
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5,0.75,0.95,0.99
    tags:
      application: ${spring.application.name}
      instance: ${HOSTNAME:${spring.application.name}-${random.uuid}}
  info:
    env:
      enabled: true
    java:
      enabled: true
    os:
      enabled: true
      
# Logging Configuration
logging:
  level:
    com.zoomtranscriber: INFO
    com.zoomtranscriber.performance: DEBUG
    com.zoomtranscriber.monitoring: DEBUG
    com.zoomtranscriber.structured: INFO
    com.zoomtranscriber.metrics: INFO
    org.springframework.web: INFO
    org.springframework.web.reactive: INFO
    reactor.netty: INFO
    root: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{correlationId:-}] %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{correlationId:-}] %logger{36} - %msg%n"
  file:
    name: logs/zoom-transcriber.log
    max-size: 100MB
    max-history: 30
  logback:
    rollingpolicy:
      max-file-size: 100MB
      total-size-cap: 10GB
      
# Zoom Transcriber Specific Configuration
zoom:
  transcriber:
    monitoring:
      enabled: true
      metrics-export-interval: 60s
      health-check-interval: 30s
      performance-tracking: true
      error-tracking: true
    audio:
      sample-rate: 44100
      bit-depth: 16
      channels: 2
      buffer-size: 4096
    transcription:
      model: whisper-1
      language: en-US
      confidence-threshold: 0.7
      enable-punctuation: true
      enable-capitalization: true
    ai-service:
      provider: ollama
      timeout: 30s
      retry-attempts: 3
      retry-delay: 1s
      
# Performance Monitoring Configuration
performance:
  monitoring:
    enabled: true
    collection-interval: 10s
    export-interval: 60s
    thresholds:
      cpu-warning: 70.0
      cpu-critical: 85.0
      memory-warning: 75.0
      memory-critical: 90.0
      error-rate-warning: 0.05
      error-rate-critical: 0.10
      
# Health Check Configuration
health:
  check:
    audio-service:
      enabled: true
      timeout: 5s
      interval: 30s
    transcription-service:
      enabled: true
      timeout: 10s
      interval: 30s
    ai-service:
      enabled: true
      timeout: 15s
      interval: 30s
    system-resources:
      enabled: true
      interval: 10s
      
# Error Tracking Configuration
error:
  tracking:
    enabled: true
    cleanup-interval: 1h
    retention-period: 24h
    alerting:
      enabled: true
      error-threshold-per-minute: 10
      critical-error-threshold-per-hour: 5
      error-rate-warning-threshold: 0.05
      error-rate-critical-threshold: 0.10
      
# Log Configuration for Structured Logging
structured:
  logging:
    enabled: true
    json-format: true
    include-stack-trace: true
    include-mdc: true
    correlation-id-header: X-Correlation-ID
    
# Metrics Collection Configuration
metrics:
  collection:
    enabled: true
    interval: 10s
    export:
      prometheus:
        enabled: true
        endpoint: /actuator/prometheus
      jvm:
        enabled: true
      system:
        enabled: true
      custom:
        enabled: true
        
# Thread Pool Configuration
thread-pool:
  async:
    core-size: 4
    max-size: 16
    queue-capacity: 100
    thread-name-prefix: zoom-async-
  health-check:
    core-size: 2
    max-size: 8
    queue-capacity: 50
    thread-name-prefix: zoom-health-
  metrics:
    core-size: 2
    max-size: 8
    queue-capacity: 50
    thread-name-prefix: zoom-metrics-